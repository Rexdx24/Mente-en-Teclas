const startBtn=document.getElementById('startBtn');const levelSel=document.getElementById('level');const countSel=document.getElementById('count');const problemEl=document.getElementById('problem');const answerInput=document.getElementById('answer');const submitBtn=document.getElementById('submitBtn');const progressEl=document.getElementById('progress');const correctEl=document.getElementById('correct');const wrongEl=document.getElementById('wrong');const feedback=document.getElementById('feedback');const keyboard=document.getElementById('keyboard');const summaryLevel=document.getElementById('summaryLevel');const summaryCount=document.getElementById('summaryCount');const accuracy=document.getElementById('accuracy');const cpm=document.getElementById('cpm');const avgTime=document.getElementById('avgTime');const digits=['1','2','3','4','5','6','7','8','9','0'];digits.forEach(d=>{const k=document.createElement('div');k.className='key';k.textContent=d;keyboard.appendChild(k);});let total=0,current=0,correct=0,wrong=0,startTime=0,totalKeyStrokes=0,times=[],currentAnswer=null;function randInt(m){return Math.floor(Math.random()*(m+1));}function nextProblem(l){const o=Math.random()<0.5?'+':'-';let a,b;if(l==='easy'){a=randInt(9);b=randInt(9);}else if(l==='mid'){a=randInt(20);b=randInt(20);}else{a=randInt(99);b=randInt(99);}if(o==='-'&&b>a)[a,b]=[b,a];currentAnswer=o==='+'?a+b:a-b;problemEl.innerHTML=`${a} ${o} ${b} =`; }function startGame(){total=parseInt(countSel.value,10);current=0;correct=0;wrong=0;times=[];totalKeyStrokes=0;startTime=performance.now();answerInput.disabled=false;submitBtn.disabled=false;answerInput.value='';answerInput.focus();summaryLevel.textContent=levelSel.options[levelSel.selectedIndex].text;summaryCount.textContent=total;correctEl.textContent='0';wrongEl.textContent='0';progressEl.textContent=`0/${total}`;feedback.textContent='Escribe la respuesta y presiona Enter.';nextProblem(levelSel.value);}function endGame(){answerInput.disabled=true;submitBtn.disabled=true;const totalTime=(performance.now()-startTime)/1000;const acc=total?((correct/total)*100).toFixed(0):'0';const strokesPerMin=Math.round((totalKeyStrokes/(totalTime||1))*60);const avg=times.length?(times.reduce((a,b)=>a+b,0)/times.length).toFixed(2)+'s':'-';accuracy.textContent=acc+'%';cpm.textContent=strokesPerMin;avgTime.textContent=avg;feedback.innerHTML=`Juego finalizado — ${correct} correctas, ${wrong} incorrectas.`;problemEl.innerHTML='<strong>¡Bien hecho!</strong>'; }function submitAnswer(){if(answerInput.disabled)return;const val=answerInput.value.trim();if(val==='')return;const num=Number(val);if(Number.isNaN(num)){feedback.innerHTML='<span class="wrong">Escribe solo números.</span>';answerInput.value='';return;}current++;progressEl.textContent=`${current}/${total}`;if(num===currentAnswer){correct++;correctEl.textContent=correct;feedback.innerHTML='<span class="correct">✔ Correcto</span>';}else{wrong++;wrongEl.textContent=wrong;feedback.innerHTML=`<span class="wrong">✖ Incorrecto — ${currentAnswer}</span>`;}answerInput.value='';if(current<total){nextProblem(levelSel.value);}else{endGame();}}startBtn.addEventListener('click',startGame);submitBtn.addEventListener('click',submitAnswer);answerInput.addEventListener('keydown',e=>{if(e.key.length===1)totalKeyStrokes++;if(e.key==='Enter'){e.preventDefault();submitAnswer();}});window.addEventListener('keydown',e=>{if(/^[0-9]$/.test(e.key)){const match=[...document.querySelectorAll('.key')].find(k=>k.textContent===e.key);if(match){match.classList.add('active');setTimeout(()=>match.classList.remove('active'),180);}}});keyboard.addEventListener('click',e=>{const t=e.target;if(!t.classList.contains('key'))return;if(answerInput.disabled)return;answerInput.value+=t.textContent;answerInput.focus();totalKeyStrokes++;});